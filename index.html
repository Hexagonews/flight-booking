<!DOCTYPE html>
<html>
<head>
<title>LEGO Airport</title>
<style>
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:linear-gradient(#66b9ff,#eaf6ff);
}
header{
  background:#003366;
  color:white;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1{margin:0;}

.container{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:20px;
  padding:20px;
}

.panel{
  background:white;
  border-radius:16px;
  padding:15px;
  width:420px;
  box-shadow:0 8px 20px rgba(0,0,0,.25);
}

label{font-weight:bold;display:block;margin-top:10px;}
input{
  width:100%;
  padding:8px;
  margin-top:4px;
  border-radius:8px;
  border:1px solid #ccc;
}

.custom-select{
  position:relative;
  width:100%;
  border:2px solid #003366;
  border-radius:12px;
  background:#e0f0ff;
  cursor:pointer;
  user-select:none;
  margin-top:6px;
}
.custom-select .selected{
  padding:10px 14px;
  font-weight:bold;
  color:#003366;
}
.custom-select .options{
  display:none;
  position:absolute;
  top:100%;
  left:0;
  right:0;
  border:2px solid #003366;
  border-top:none;
  background:#ffffff;
  z-index:10;
  max-height:150px;
  overflow-y:auto;
}
.custom-select .options div{
  padding:10px 14px;
  cursor:pointer;
}
.custom-select .options div:hover{
  background:#cce0ff;
}

button{
  width:100%;
  margin-top:15px;
  padding:12px;
  background:#ff9800;
  border:none;
  border-radius:10px;
  font-size:16px;
}

button.reset{
  background:#d32f2f;
  margin-top:10px;
}

table{width:100%;border-collapse:collapse;margin-top:10px;}
th{background:#003366;color:white;}
td,th{padding:6px;text-align:center;border-bottom:1px solid #ccc;}

tr.return-flight td{background:#fff3cd;} /* return flights highlighted */

.plane{
  position:fixed;
  bottom:30px;
  left:-80px;
  font-size:50px;
  animation:fly 5s linear forwards;
}
@keyframes fly{to{left:110%;}}

.announce{
  background:#003366;
  color:white;
  padding:10px;
  border-radius:10px;
  margin-top:10px;
  text-align:center;
}
</style>
</head>

<body>

<header>
<h1>LEGO Airport</h1>
<div id="clock"></div>
</header>

<div class="container">

<div class="panel">
<h2>Airport Control Desk</h2>

<label>Airline</label>
<div class="custom-select" id="airlineSelect">
  <div class="selected">Select Airline</div>
</div>

<label>Destination</label>
<div class="custom-select" id="destinationSelect">
  <div class="selected">Select Destination</div>
</div>

<label>Ticket Type</label>
<div class="custom-select" id="ticketTypeSelect">
  <div class="selected">Select Type</div>
</div>

<label>Departure Time</label>
<input type="time" id="timeOut">

<label id="returnLabel" style="display:none;">Return Time</label>
<input type="time" id="timeReturn" style="display:none;">

<label>Seats</label>
<input type="number" id="seats">

<button onclick="bookFlight()">Buy Ticket</button>
<button class="reset" onclick="resetAirport()">Reset Airport</button>

<div class="announce" id="announcements">No announcements</div>
</div>

<div class="panel">
<h2>Departures Board</h2>
<table>
<thead><tr><th>Time</th><th>Gate</th><th>Airline</th><th>To</th><th>Seats</th><th>Status</th></tr></thead>
<tbody id="list"></tbody>
</table>
</div>

<audio id="ding" src="https://www.soundjay.com/button/sounds/button-16.mp3"></audio>

<script>
const airlines=["Cargo A","Eagle Alliance","Police Airlines","Star Allegiance","Peak"];
const destinations=[
 {n:"Aubrey / Mummy's Room",s:false},
 {n:"Julian's Room",s:false},
 {n:"Aubrey's Mansion",s:true},
 {n:"In-between Elliot & Aubrey's Desk",s:true},
 {n:"Living Room",s:true},
 {n:"The Buffet",s:true}
];

function gateFor(a){if(a==="Cargo A")return "Cargo"; if(a==="Star Allegiance")return "Gate 3"; return Math.random()<0.5?"Gate 1":"Gate 2";}
function seatLimit(a){if(a==="Cargo A")return 0; if(a==="Star Allegiance")return 2; return 7;}
function to12(t){let[h,m]=t.split(":");h=parseInt(h);let a=h>=12?"PM":"AM";h=h%12||12; return h+":"+m+" "+a;}

function setupCustomSelect(selectId,optionsArray,callback){
  const sel=document.getElementById(selectId);
  const selected=sel.querySelector(".selected");
  let opts=sel.querySelector(".options");
  if(!opts){opts=document.createElement("div"); opts.className="options"; sel.appendChild(opts);}
  opts.innerHTML="";
  optionsArray.forEach(o=>{
    let div=document.createElement("div");
    div.textContent=typeof o==="object"?o.n||o.text:o;
    div.onclick=()=>{
      selected.textContent=div.textContent;
      opts.style.display="none";
      if(callback)callback(div.textContent);
    };
    opts.appendChild(div);
  });
  selected.onclick=()=>{opts.style.display=opts.style.display==="block"?"none":"block";}
}

// Initialize dropdowns
setupCustomSelect("airlineSelect",airlines,(val)=>{
  updateDestinations(val);
  updateSeats(val);
});
setupCustomSelect("ticketTypeSelect", ["One-way","Return"], (val)=>{
    if(val === "Return"){
        document.getElementById("timeReturn").style.display="block";
        document.getElementById("returnLabel").style.display="block";
    } else {
        document.getElementById("timeReturn").style.display="none";
        document.getElementById("returnLabel").style.display="none";
    }
});

function updateDestinations(airlineVal){
  let airline=airlineVal||document.querySelector("#airlineSelect .selected").textContent;
  let options=destinations.filter(d=>!d.s||airline==="Star Allegiance").map(d=>d.n);
  setupCustomSelect("destinationSelect",options);
}

function updateSeats(a){
  let airline=a||document.querySelector("#airlineSelect .selected").textContent;
  let max=seatLimit(airline);
  const seatInput=document.getElementById("seats");
  if(max===0){seatInput.value=0;seatInput.disabled=true;}
  else{seatInput.value=1; seatInput.max=max; seatInput.disabled=false;}
}

function bookFlight(){
  const airline=document.querySelector("#airlineSelect .selected").textContent;
  const dest=document.querySelector("#destinationSelect .selected").textContent;
  const type=document.querySelector("#ticketTypeSelect .selected").textContent;
  const timeOut=document.getElementById("timeOut").value;
  const timeReturn=document.getElementById("timeReturn").value;
  if(!timeOut||airline==="Select Airline"||dest==="Select Destination"||type==="Select Type"){return alert("Select all fields");}

  let flights=JSON.parse(localStorage.flights||"[]");

  function addTicket(time,destination,isReturn){
    let existing = flights.find(f => f.airline===airline && f.dest===destination && f.time===time && f.isReturn===isReturn);
    if(existing){
      if(existing.seats>=existing.max) return alert("Flight full!");
      existing.seats++;
    } else {
      flights.push({
        id:Math.floor(Math.random()*900+100),
        airline,
        time:time,
        dest:destination,
        gate:gateFor(airline),
        seats:1,
        max:seatLimit(airline),
        status:"Scheduled",
        announced:false,
        isReturn:isReturn
      });
    }
  }

  // Outbound
  addTicket(timeOut,dest,false);

  // Return if needed
  if(type==="Return"){
    if(!timeReturn) return alert("Select return time");
    addTicket(timeReturn,"Return from "+dest,true);
  }

  localStorage.flights=JSON.stringify(flights);
  loadFlights();
}

function loadFlights(){
  let flights=JSON.parse(localStorage.flights||"[]");
  const list=document.getElementById("list");
  list.innerHTML="";
  let now=new Date();

  flights.sort((a,b)=>a.time.localeCompare(b.time));

  flights.forEach(f=>{
    let [h,m]=f.time.split(":");
    let ft=new Date(); ft.setHours(h,m,0);

    if(now>ft && f.status==="Scheduled"){
      if(f.seats>0||f.max===0){f.status="Departed";fly();}
      else f.status="Cancelled";
    }

    if(now>(new Date(ft-5*60000)) && !f.announced && f.status==="Scheduled"){
      announce(`Flight ${f.id} to ${f.dest} now boarding at ${f.gate}`);
      const ding = document.getElementById("ding");
      ding.currentTime=0;
      ding.play();
      ding.onended=()=>{
        if('speechSynthesis' in window){
          let msg=new SpeechSynthesisUtterance(`Flight ${f.id} to ${f.dest} now boarding at ${f.gate}`);
          window.speechSynthesis.speak(msg);
        }
      };
      f.announced=true;
    }

    let r=document.createElement("tr");
    if(f.isReturn) r.classList.add("return-flight");
    r.innerHTML=`<td>${to12(f.time)}</td>
                 <td>${f.gate}</td>
                 <td>${f.airline}</td>
                 <td>${f.dest}</td>
                 <td>${f.seats}/${f.max}</td>
                 <td>${f.status}</td>`;
    list.appendChild(r);
  });

  localStorage.flights=JSON.stringify(flights);
}

function announce(t){document.getElementById("announcements").textContent=t;}
function fly(){let p=document.createElement("div");p.className="plane";p.textContent="✈️";document.body.appendChild(p); setTimeout(()=>p.remove(),5000);}
function resetAirport(){
  if(confirm("Are you sure you want to reset all flights?")){
    localStorage.flights="[]";
    document.getElementById("announcements").textContent="No announcements";
    loadFlights();
  }
}
function clock(){let d=new Date(); let h=d.getHours(),m=d.getMinutes(); let a=h>=12?"PM":"AM"; h=h%12||12; document.getElementById("clock").textContent=h+":"+m.toString().padStart(2,"0")+" "+a;}
function newDay(){let d=new Date().toDateString(); if(localStorage.day!==d){localStorage.day=d; localStorage.flights="[]";}}
newDay(); loadFlights(); setInterval(()=>{clock(); loadFlights();},1000);
</script>
</body>
</html>
