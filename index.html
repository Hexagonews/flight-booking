<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LEGO Airport</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:linear-gradient(#74c7ff,#eaf6ff);
}
header{
  background:#003366;
  color:white;
  padding:12px;
  display:flex;
  justify-content:space-between;
}
.container{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
}
.panel{
  background:white;
  border-radius:18px;
  padding:15px;
  margin:10px;
  box-shadow:0 8px 20px rgba(0,0,0,.25);
  width:420px;
}
h3{margin-top:0;}
.custom{
  border:2px solid #003366;
  border-radius:10px;
  padding:8px;
  margin-top:6px;
  cursor:pointer;
  background:#eef6ff;
}
.custom .opts{
  display:none;
  background:white;
  border-radius:10px;
  margin-top:6px;
  box-shadow:0 5px 15px rgba(0,0,0,.3);
}
.custom .opts div{
  padding:8px;
}
.custom .opts div:hover{background:#dbeeff;}
input,button,select{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:10px;
  border:none;
}
button{background:#ff9800;font-size:16px;}
table{width:100%;border-collapse:collapse;}
th{background:#003366;color:white;}
td,th{text-align:center;padding:6px;}
.return{background:#fff4c2;}
#unlock{
  background:#2ecc71;
  margin:10px;
}
#announce{
  margin-top:10px;
  background:#003366;
  color:white;
  padding:8px;
  border-radius:10px;
}

/* --- Slick Loading Animation --- */
#loader{
  position:fixed;
  inset:0;
  background:#003366;
  color:white;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-size:24px;
  z-index:999;
}

#plane{
  font-size:50px;
  animation: bounce 1s infinite alternate;
  margin-bottom:20px;
}

@keyframes bounce{
  0%{transform:translateY(0) rotate(-10deg);}
  50%{transform:translateY(-20px) rotate(10deg);}
  100%{transform:translateY(0) rotate(-10deg);}
}

#loadingText{
  font-size:24px;
  letter-spacing:2px;
  animation: fade 1.5s infinite alternate;
}

@keyframes fade{
  0%{opacity:0.3;}
  100%{opacity:1;}
}
</style>
</head>

<body>

<!-- --- Loading Screen --- -->
<div id="loader">
  <div id="plane">✈️</div>
  <div id="loadingText">Loading LEGO Airport...</div>
</div>

<header>
<h2>LEGO Airport</h2>
<div id="clock"></div>
</header>

<button id="unlock">Tap to enable announcements</button>

<div class="container">

<div class="panel">
<h3>Control Desk</h3>

<div class="custom" id="airline"><div class="sel">Select Airline</div><div class="opts"></div></div>
<div class="custom" id="dest"><div class="sel">Select Destination</div><div class="opts"></div></div>
<div class="custom" id="type"><div class="sel">One-way</div><div class="opts"></div></div>

<label>Departure Time</label>
<input type="time" id="time">

<label id="retLab">Return Time</label>
<select id="ret">
  <option value="">Select later</option>
  <option>12:00</option><option>14:00</option><option>16:00</option>
</select>

<label>Seats</label>
<input type="number" id="seats" value="1" min="1">

<button onclick="book()">Buy Ticket</button>
<button onclick="resetAirport()" style="background:#e74c3c;">Reset Airport (New Day)</button>
</div>

<div class="panel">
<h3>Departures</h3>
<table>
<thead><tr><th>Time</th><th>To</th><th>Gate</th><th>Seats</th><th>Status</th></tr></thead>
<tbody id="list"></tbody>
</table>
<div id="announce">No announcements</div>
</div>

</div>

<audio id="ding" src="https://www.soundjay.com/button/sounds/button-16.mp3"></audio>

<script>
let flights=JSON.parse(localStorage.flights||"[]");

function gateFor(a){
 if(a==="Cargo A")return"Cargo Gate";
 if(a==="Eagle Alliance")return"Gate 1";
 if(a==="Police Airlines")return"Gate 2";
 if(a==="Star Allegiance")return"Gate 3";
 return"Gate 2";
}
function seatLimit(a){
 if(a==="Star Allegiance")return 2;
 if(a==="Cargo A")return 999;
 return 7;
}

function setup(id,arr,cb){
 let el=document.getElementById(id);
 let sel=el.querySelector(".sel");
 let o=el.querySelector(".opts");
 arr.forEach(v=>{
  let d=document.createElement("div");
  d.textContent=v;
  d.onclick=()=>{sel.textContent=v;o.style.display="none";cb&&cb(v);}
  o.appendChild(d);
 });
 sel.onclick=()=>o.style.display=o.style.display==="block"?"none":"block";
}

setup("airline",["Star Allegiance","Eagle Alliance","Cargo A","Police Airlines","Peak"]);
setup("dest",["Living Room","Aubrey's Mansion","Julian's Room"]);
setup("type",["One-way","Return"],v=>{
 retLab.style.display=v==="Return"?"block":"none";
 ret.style.display=v==="Return"?"block":"none";
});

document.getElementById("unlock").onclick=()=>{
 speechSynthesis.speak(new SpeechSynthesisUtterance("Announcements enabled"));
 unlock.style.display="none";
};

function book(){
 let airline=document.querySelector("#airline .sel").textContent;
 let dest=document.querySelector("#dest .sel").textContent;
 let type=document.querySelector("#type .sel").textContent;
 let time=document.getElementById("time").value;
 let seats=parseInt(document.getElementById("seats").value);
 if(!time||airline==="Select Airline"||dest==="Select Destination")return alert("Fill all fields");

 addFlight(time,dest,seats,false,airline);
 if(type==="Return" && ret.value){
   addFlight(ret.value,"Return from "+dest,seats,true,airline);
 }
 localStorage.flights=JSON.stringify(flights);
}

function addFlight(time,dest,seats,isReturn,airline){
 let f=flights.find(x=>x.time===time&&x.dest===dest&&x.airline===airline);
 if(f) f.seats+=seats;
 else flights.push({time,dest,seats,airline,gate:gateFor(airline),status:"Scheduled",ann:false,final:false,ret:isReturn});
}

function resetAirport(){
 if(!confirm("Start a new day and delete all flights?")) return;
 localStorage.removeItem("flights");
 flights=[];
 loop();
}

function speak(t){
 announce.textContent=t;
 ding.currentTime=0;
 ding.play();
 ding.onended=()=>speechSynthesis.speak(new SpeechSynthesisUtterance(t));
}

function to12(t){
 let[h,m]=t.split(":");h=parseInt(h);let a=h>=12?"PM":"AM";h=h%12||12;
 return h+":"+m+" "+a;
}

function loop(){
 let now=new Date();
 list.innerHTML="";
 flights.sort((a,b)=>a.time.localeCompare(b.time));
 flights.forEach(f=>{
  let[h,m]=f.time.split(":");
  let ft=new Date();ft.setHours(h,m,0);
  let boarding=new Date(ft-10*60000);
  let final=new Date(ft-3*60000);

  if(now>boarding&&!f.ann&&f.status==="Scheduled"){speak(`Flight to ${f.dest} now boarding at ${f.gate}`);f.ann=true;}
  if(now>final&&!f.final&&f.status==="Scheduled"){speak(`Final call for flight to ${f.dest} at ${f.gate}`);f.final=true;}
  if(now>ft&&f.status==="Scheduled")f.status=f.seats>0?"Departed":"Cancelled";

  let r=document.createElement("tr");
  if(f.ret)r.className="return";
  r.innerHTML=`<td>${to12(f.time)}</td><td>${f.dest}</td><td>${f.gate}</td><td>${f.seats}</td><td>${f.status}</td>`;
  list.appendChild(r);
 });
 localStorage.flights=JSON.stringify(flights);
}

setInterval(()=>{
 let d=new Date();
 clock.textContent=(d.getHours()%12||12)+":"+d.getMinutes().toString().padStart(2,"0");
 loop();
},1000);

setTimeout(()=>loader.style.display="none",2000);
</script>

</body>
</html>
