<!DOCTYPE html>
<html>
<head>
<title>LEGO Airport</title>
<style>
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:linear-gradient(#66b9ff,#eaf6ff);
}
header{
  background:#003366;
  color:white;
  padding:15px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
h1{margin:0;}

.container{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:20px;
  padding:20px;
}

.panel{
  background:white;
  border-radius:16px;
  padding:15px;
  width:380px;
  box-shadow:0 8px 20px rgba(0,0,0,.25);
}

label{font-weight:bold;display:block;margin-top:10px;}
input{
  width:100%;
  padding:8px;
  margin-top:4px;
  border-radius:8px;
  border:1px solid #ccc;
}

/* CUSTOM DROPDOWNS */
.custom-select{
  position:relative;
  width:100%;
  border:2px solid #003366;
  border-radius:12px;
  background:#e0f0ff;
  cursor:pointer;
  user-select:none;
  margin-top:6px;
}
.custom-select .selected{
  padding:10px 14px;
  font-weight:bold;
  color:#003366;
}
.custom-select .options{
  display:none;
  position:absolute;
  top:100%;
  left:0;
  right:0;
  border:2px solid #003366;
  border-top:none;
  background:#ffffff;
  z-index:10;
  max-height:150px;
  overflow-y:auto;
}
.custom-select .options div{
  padding:10px 14px;
  cursor:pointer;
}
.custom-select .options div:hover{
  background:#cce0ff;
}

button{
  width:100%;
  margin-top:15px;
  padding:12px;
  background:#ff9800;
  border:none;
  border-radius:10px;
  font-size:16px;
}

button.reset{
  background:#d32f2f;
  margin-top:10px;
}

table{width:100%;border-collapse:collapse;margin-top:10px;}
th{background:#003366;color:white;}
td,th{padding:6px;text-align:center;border-bottom:1px solid #ccc;}

.plane{
  position:fixed;
  bottom:30px;
  left:-80px;
  font-size:50px;
  animation:fly 5s linear forwards;
}
@keyframes fly{to{left:110%;}}

.announce{
  background:#003366;
  color:white;
  padding:10px;
  border-radius:10px;
  margin-top:10px;
  text-align:center;
}
</style>
</head>

<body>

<header>
<h1>ðŸ§± LEGO Airport</h1>
<div id="clock"></div>
</header>

<div class="container">

<div class="panel">
<h2>ðŸ§¾ Airport Control Desk</h2>

<label>Airline</label>
<div class="custom-select" id="airlineSelect">
  <div class="selected">Select Airline</div>
  <div class="options"></div>
</div>

<label>Time</label>
<input type="time" id="time">

<label>Destination</label>
<div class="custom-select" id="destinationSelect">
  <div class="selected">Select Destination</div>
  <div class="options"></div>
</div>

<label>Seats</label>
<input type="number" id="seats">

<button onclick="bookFlight()">Create Flight</button>
<button class="reset" onclick="resetAirport()">Reset Airport</button>

<div class="announce" id="announcements">No announcements</div>
</div>

<div class="panel">
<h2>ðŸ“º Departures Board</h2>
<table>
<thead><tr><th>Time</th><th>Gate</th><th>Airline</th><th>To</th><th>Seats</th><th>Status</th></tr></thead>
<tbody id="list"></tbody>
</table>
</div>

<div class="panel">
<h2>ðŸ“± Passenger Check-in</h2>

<label>Choose Flight</label>
<div class="custom-select" id="checkFlightSelect">
  <div class="selected">Select Flight</div>
  <div class="options"></div>
</div>

<button onclick="checkIn()">Check In Passenger</button>
<div id="ticket"></div>
</div>

<!-- Airport notification sound -->
<audio id="ding" src="https://www.soundjay.com/button/sounds/button-16.mp3"></audio>

<script>
const airlines=["Cargo A","Eagle Alliance","Police Airlines","Star Allegiance","Peak"];
const destinations=[
 {n:"Aubrey / Mummy's Room",s:false},
 {n:"Julian's Room",s:false},
 {n:"Aubrey's Mansion",s:true},
 {n:"In-between Elliot & Aubrey's Desk",s:true},
 {n:"Living Room",s:true},
 {n:"The Buffet",s:true}
];

function gateFor(a){if(a==="Cargo A")return "Cargo"; if(a==="Star Allegiance")return "Gate 3"; return Math.random()<0.5?"Gate 1":"Gate 2";}
function seatLimit(a){if(a==="Cargo A")return 0; if(a==="Star Allegiance")return 2; return 7;}
function to12(t){let[h,m]=t.split(":");h=parseInt(h);let a=h>=12?"PM":"AM";h=h%12||12; return h+":"+m+" "+a;}

function setupCustomSelect(selectId,optionsArray,callback){
  const sel=document.getElementById(selectId);
  const selected=sel.querySelector(".selected");
  const opts=sel.querySelector(".options");
  opts.innerHTML="";
  optionsArray.forEach(o=>{
    let div=document.createElement("div");
    div.textContent=typeof o==="object"?o.n||o.text:o;
    div.onclick=()=>{
      selected.textContent=div.textContent;
      opts.style.display="none";
      if(callback)callback(o);
    };
    opts.appendChild(div);
  });
  selected.onclick=()=>{opts.style.display=opts.style.display==="block"?"none":"block";}
}

// Initialize Airline dropdown
setupCustomSelect("airlineSelect",airlines,(val)=>{
  updateDestinations(val);
  updateSeats(val);
});

function updateDestinations(airlineVal){
  let airline=airlineVal||document.querySelector("#airlineSelect .selected").textContent;
  let options=destinations.filter(d=>!d.s||airline==="Star Allegiance").map(d=>d.n);
  setupCustomSelect("destinationSelect",options);
}

function updateSeats(a){
  let airline=a||document.querySelector("#airlineSelect .selected").textContent;
  let max=seatLimit(airline);
  const seatInput=document.getElementById("seats");
  if(max===0){seatInput.value=0;seatInput.disabled=true;}
  else{seatInput.value=1; seatInput.max=max; seatInput.disabled=false;}
}

function bookFlight(){
  const airline=document.querySelector("#airlineSelect .selected").textContent;
  const dest=document.querySelector("#destinationSelect .selected").textContent;
  const timeInput=document.getElementById("time").value;
  if(!timeInput||airline==="Select Airline"||dest==="Select Destination"){return alert("Select all fields");}
  let flights=JSON.parse(localStorage.flights||"[]");
  flights.push({
    id:Math.floor(Math.random()*900+100),
    airline,
    time:timeInput,
    dest,
    gate:gateFor(airline),
    seats:0,
    max:seatLimit(airline),
    status:"Scheduled",
    announced:false
  });
  localStorage.flights=JSON.stringify(flights);
  loadFlights();
  updateCheckinDropdown();
}

function loadFlights(){
  let flights=JSON.parse(localStorage.flights||"[]");
  const list=document.getElementById("list");
  list.innerHTML="";
  let now=new Date();

  flights.sort((a,b)=>a.time.localeCompare(b.time));

  flights.forEach(f=>{
    let [h,m]=f.time.split(":");
    let ft=new Date(); ft.setHours(h,m,0);

    if(now>ft && f.status==="Scheduled"){
      if(f.seats>0||f.max===0){f.status="Departed";fly();}
      else f.status="Cancelled";
    }

    if(now>(new Date(ft-5*60000)) && !f.announced && f.status==="Scheduled"){
      announce(`Flight ${f.id} to ${f.dest} now boarding at ${f.gate}`);
      const ding = document.getElementById("ding");
      ding.currentTime=0;
      ding.play();
      ding.onended=()=>{
        if('speechSynthesis' in window){
          let msg=new SpeechSynthesisUtterance(`Flight ${f.id} to ${f.dest} now boarding at ${f.gate}`);
          window.speechSynthesis.speak(msg);
        }
      };
      f.announced=true;
    }

    let r=document.createElement("tr");
    r.innerHTML=`<td>${to12(f.time)}</td>
                 <td>${f.gate}</td>
                 <td>${f.airline}</td>
                 <td>${f.dest}</td>
                 <td>${f.seats}/${f.max}</td>
                 <td>${f.status}</td>`;
    list.appendChild(r);
  });

  localStorage.flights=JSON.stringify(flights);
}

function updateCheckinDropdown(){
  const checkFlightSel=document.getElementById("checkFlightSelect");
  const opts=checkFlightSel.querySelector(".options");
  opts.innerHTML="";
  checkFlightSel.querySelector(".selected").textContent="Select Flight";
  delete checkFlightSel.querySelector(".selected").dataset.id;

  let flights=JSON.parse(localStorage.flights||"[]");
  flights.forEach(f=>{
    if(f.status==="Scheduled" && f.seats<f.max){
      let div=document.createElement("div");
      div.textContent=`${f.id} â€“ ${f.airline} â€“ ${f.dest} (${f.seats}/${f.max})`;
      div.dataset.id=f.id;
      div.onclick=()=>{
        checkFlightSel.querySelector(".selected").textContent=div.textContent;
        checkFlightSel.querySelector(".selected").dataset.id=div.dataset.id;
        opts.style.display="none";
      };
      opts.appendChild(div);
    }
  });
}

function checkIn(){
  const sel=document.querySelector("#checkFlightSelect .selected");
  if(!sel.dataset.id) return alert("Select a flight");

  const id=parseInt(sel.dataset.id);
  let flights=JSON.parse(localStorage.flights||"[]");
  let f=flights.find(x=>x.id===id);
  if(!f) return alert("Flight not found");
  if(f.seats>=f.max) return alert("No seats available");

  f.seats++;
  localStorage.flights=JSON.stringify(flights);

  loadFlights();
  updateCheckinDropdown();

  document.getElementById("ticket").innerHTML=
    `ðŸŽ« Ticket for Flight ${f.id}<br>${f.airline}<br>${f.dest}<br>${f.gate}`;
}

function announce(t){document.getElementById("announcements").textContent=t;}
function fly(){let p=document.createElement("div");p.className="plane";p.textContent="âœˆï¸";document.body.appendChild(p); setTimeout(()=>p.remove(),5000);}
function resetAirport(){
  if(confirm("Are you sure you want to reset all flights?")){
    localStorage.flights="[]";
    document.getElementById("ticket").innerHTML="";
    document.getElementById("announcements").textContent="No announcements";
    loadFlights();
    updateCheckinDropdown();
  }
}
function clock(){let d=new Date(); let h=d.getHours(),m=d.getMinutes(); let a=h>=12?"PM":"AM"; h=h%12||12; document.getElementById("clock").textContent=h+":"+m.toString().padStart(2,"0")+" "+a;}
function newDay(){let d=new Date().toDateString(); if(localStorage.day!==d){localStorage.day=d; localStorage.flights="[]";}}
newDay(); loadFlights(); setInterval(()=>{clock(); loadFlights();},1000);
</script>
</body>
</html>
