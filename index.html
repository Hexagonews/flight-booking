<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>LEGO Airport</title>
<style>
body{margin:0;font-family:Segoe UI,Arial;background:linear-gradient(#66b9ff,#eaf6ff);}
#loadingScreen{position:fixed;inset:0;background:#003366;color:white;display:flex;justify-content:center;align-items:center;font-size:28px;z-index:1000;flex-direction:column;}
#loadingPlane{font-size:60px;animation:float 2s infinite ease-in-out;}
@keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-20px);}}

header{background:#003366;color:white;padding:15px;display:flex;justify-content:space-between;align-items:center;}

.container{display:flex;flex-wrap:wrap;justify-content:center;gap:20px;padding:20px;}
.panel{background:white;border-radius:16px;padding:15px;width:420px;box-shadow:0 8px 20px rgba(0,0,0,.25);}
label{font-weight:bold;margin-top:8px;display:block;}
input,button,select{width:100%;padding:10px;margin-top:6px;border-radius:10px;border:1px solid #ccc;}
button{background:#ff9800;font-size:16px;}
button.reset{background:#d32f2f;color:white;}

.custom-select{background:#e0f0ff;border:2px solid #003366;border-radius:10px;margin-top:6px;cursor:pointer;user-select:none;}
.custom-select .selected{padding:10px;font-weight:bold;color:#003366;}
.custom-select .options{display:none;border-top:2px solid #003366;background:white;max-height:160px;overflow:auto;}
.custom-select .options div{padding:10px;}
.custom-select .options div:hover{background:#cce0ff;}

table{width:100%;border-collapse:collapse;margin-top:10px;}
th{background:#003366;color:white;}
td,th{padding:6px;text-align:center;border-bottom:1px solid #ccc;}
tr.return td{background:#fff3cd;}

.plane{position:fixed;bottom:30px;left:-80px;font-size:50px;animation:fly 6s linear forwards;}
@keyframes fly{to{left:110%;}}

.announce{background:#003366;color:white;padding:10px;border-radius:10px;margin-top:10px;}
</style>
</head>
<body>

<div id="loadingScreen">
  <div id="loadingPlane">✈️</div>
  Loading LEGO Airport…
</div>

<header>
<h1>LEGO Airport</h1>
<div id="clock"></div>
</header>

<div class="container">
<div class="panel">
<h2>Control Desk</h2>

<label>Airline</label>
<div class="custom-select" id="airlineSelect"><div class="selected">Select Airline</div></div>

<label>Destination</label>
<div class="custom-select" id="destinationSelect"><div class="selected">Select Destination</div></div>

<label>Ticket Type</label>
<div class="custom-select" id="ticketTypeSelect"><div class="selected">Select Type</div></div>

<label>Departure Date</label>
<input type="date" id="dateOut">

<label>Departure Time</label>
<input type="time" id="timeOut">

<label id="returnLabel" style="display:none;">Return Date</label>
<input type="date" id="dateReturn" style="display:none;">

<label id="returnTimeLabel" style="display:none;">Return Time</label>
<input type="time" id="timeReturn" style="display:none;">

<div id="selectLaterBox" style="display:none; margin-top:6px;">
  <label>Return Flight Option</label>
  <select id="selectLater">
    <option value="set">Set Date & Time</option>
    <option value="later">Select Later</option>
  </select>
</div>

<label>Seats</label>
<input type="number" id="seats">

<button onclick="bookFlight()">Buy Ticket</button>
<button class="reset" onclick="resetAirport()">Reset Airport</button>

<div class="announce" id="announcements">No announcements</div>
</div>

<div class="panel">
<h2>Departures</h2>
<table>
<thead><tr><th>Date</th><th>Time</th><th>Gate</th><th>To</th><th>Seats</th><th>Status</th></tr></thead>
<tbody id="list"></tbody>
</table>
</div>
</div>

<audio id="ding" preload="auto">
  <source src="https://www.soundjay.com/buttons/sounds/button-16.mp3" type="audio/mpeg">
</audio>

<script>
// Airlines and destinations
const airlines=["Cargo A","Eagle Alliance","Police Airlines","Star Allegiance","Peak"];
const allDestinations=[
  "Aubrey's Room",
  "Julian's Room",
  "Aubrey's Mansion",
  "Living Room",
  "The Buffet",
  "In-between Elliot & Aubrey's Desk"
];

// Helpers
function to12(t){let[h,m]=t.split(":");h=parseInt(h);let a=h>=12?"PM":"AM";h=h%12||12;return h+":"+m+" "+a;}
function prettyDate(d){return new Date(d).toLocaleDateString("en-AU",{weekday:"short",day:"numeric",month:"short"});}
function gateFor(airline){
  if(airline==="Cargo A") return "Cargo Gate";
  if(airline==="Star Allegiance") return "Gate 3";
  return Math.random()<0.5?"Gate 1":"Gate 2";
}
function seatLimit(a){if(a==="Cargo A") return 0;if(a==="Star Allegiance") return 2;return 7;}

// Dropdowns
function setupSelect(id,arr,cb){
 let s=document.getElementById(id).querySelector(".selected");
 let sel=document.getElementById(id); sel.querySelector(".options")?.remove();
 let o=document.createElement("div");o.className="options";sel.appendChild(o);
 arr.forEach(v=>{
   let d=document.createElement("div");d.textContent=v;
   d.onclick=()=>{s.textContent=v;o.style.display="none";if(cb)cb(v);}
   o.appendChild(d);
 });
 s.onclick=()=>o.style.display=o.style.display=="block"?"none":"block";
}

// Update destinations per airline
function updateDestinations(airline){
  let allowed = airline==="Star Allegiance"?allDestinations:["Aubrey's Room","Julian's Room"];
  setupSelect("destinationSelect",allowed);
}

// Show/hide return
function toggleReturn(v){
  let s=v==="Return";
  ["returnLabel","returnTimeLabel","dateReturn","timeReturn","selectLaterBox"].forEach(id=>document.getElementById(id).style.display=s?"block":"none");
  if(!s) document.getElementById("selectLater").value="set";
}

// Init dropdowns
setupSelect("airlineSelect",airlines,(val)=>{document.getElementById("seats").value=1; updateDestinations(val);});
setupSelect("ticketTypeSelect",["One-way","Return"],toggleReturn);

// Default date
const today=new Date().toISOString().split("T")[0];
dateOut.value=today;dateReturn.value=today;

// Book flight
function bookFlight(){
 let a=airlineSelect.querySelector(".selected").textContent;
 let d=destinationSelect.querySelector(".selected").textContent;
 let t=ticketTypeSelect.querySelector(".selected").textContent;
 let dateO=dateOut.value,timeO=timeOut.value,se=parseInt(seats.value);
 if(!dateO||!timeO||a.includes("Select")||d.includes("Select")||t.includes("Select")) return alert("Fill all fields");

 let flights=JSON.parse(localStorage.flights||"[]");

 flights.push({id:Date.now(),airline:a,dest:d,date:dateO,time:timeO,seats:se,max:seatLimit(a),gate:gateFor(a),status:"Scheduled",ann:false});

 if(t==="Return"){
   const option=document.getElementById("selectLater").value;
   if(option==="set"){
     if(!dateReturn.value || !timeReturn.value) return alert("Select return date/time");
     flights.push({id:Date.now()+1,airline:a,dest:"Return from "+d,date:dateReturn.value,time:timeReturn.value,seats:se,max:seatLimit(a),gate:gateFor(a),status:"Scheduled",ann:false,return:true});
   }
 }

 localStorage.flights=JSON.stringify(flights);
 loadFlights();
}

// Load departures
function loadFlights(){
 let flights=JSON.parse(localStorage.flights||"[]"),list=document.getElementById("list");list.innerHTML="";
 let now=new Date();
 flights.sort((a,b)=>(a.date+a.time).localeCompare(b.date+b.time));

 flights.forEach(f=>{
   let dt=new Date(f.date+"T"+f.time);
   if(now>dt&&f.status==="Scheduled"){f.status="Departed";fly();}
   if(dt-now<300000&&!f.ann&&f.status==="Scheduled"){speak(`Final call for ${f.dest} at ${f.gate}`);f.ann=true;}
   let r=document.createElement("tr");if(f.return) r.className="return";
   r.innerHTML=`<td>${prettyDate(f.date)}</td><td>${to12(f.time)}</td><td>${f.gate}</td><td>${f.dest}</td><td>${f.seats}/${f.max}</td><td>${f.status}</td>`;
   list.appendChild(r);
 });
 localStorage.flights=JSON.stringify(flights);
}

// Announcements
function speak(t){
 announcements.textContent=t;
 let d=document.getElementById("ding");d.play();
 if('speechSynthesis' in window)setTimeout(()=>speechSynthesis.speak(new SpeechSynthesisUtterance(t)),500);
}

// Plane animation
function fly(){let p=document.createElement("div");p.className="plane";p.textContent="✈️";document.body.appendChild(p);setTimeout(()=>p.remove(),6000);}
function resetAirport(){if(confirm("Reset all flights?")){localStorage.flights="[]";loadFlights();}}

// Clock
function clock(){let d=new Date();clockEl=document.getElementById("clock");clockEl.textContent=d.toLocaleString("en-AU",{weekday:"short",day:"numeric",month:"short",hour:"numeric",minute:"2-digit"});}
setInterval(()=>{clock();loadFlights();},1000);

// Hide loader
setTimeout(()=>document.getElementById("loadingScreen").style.display="none",2000);
loadFlights();clock();
</script>
</body>
</html>


